
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/img/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.4">
    
    
      
        <title>Command Line Usage in Real Life - Clinical Cancer Genomics Course</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bb3983ee.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#real-life-example-of-how-to-use-command-line-features" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Clinical Cancer Genomics Course" class="md-header__button md-logo" aria-label="Clinical Cancer Genomics Course" data-md-component="logo">
      
  <img src="../../assets/img/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Clinical Cancer Genomics Course
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Command Line Usage in Real Life
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Clinical Cancer Genomics Course" class="md-nav__button md-logo" aria-label="Clinical Cancer Genomics Course" data-md-component="logo">
      
  <img src="../../assets/img/logo.svg" alt="logo">

    </a>
    Clinical Cancer Genomics Course
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Course Details
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../schedule/" class="md-nav__link">
        Schedule
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../lectures/lectures/" class="md-nav__link">
        Lectures
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws_ec2_instances/" class="md-nav__link">
        AWS Instances Login
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Lab Session
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Lab Session" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Lab Session
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5_1">
          Day 1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day 1" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Day 1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basic_unix/" class="md-nav__link">
        Basic Unix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basics_awk/" class="md-nav__link">
        AWK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aws_env/" class="md-nav__link">
        Workspace - AWS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../R_for_bioinformatics/" class="md-nav__link">
        R for Bioinformatics
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Command Line Usage in Real Life
      </a>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_2">
          Day 2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day 2" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Day 2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../human_genome/" class="md-nav__link">
        Human Genome
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../annotation_files/" class="md-nav__link">
        Annotation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../processing_of_dna/" class="md-nav__link">
        Processing of DNA sequencing data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../intro_igv/" class="md-nav__link">
        Introduction to IGV
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_3">
          Day 3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day 3" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          Day 3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../variant_calling/" class="md-nav__link">
        Variant Calling
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_4" type="checkbox" id="__nav_5_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_4">
          Day 4
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day 4" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Day 4
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../structural_variation/" class="md-nav__link">
        Structural Variants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../analysis_of_cnv/" class="md-nav__link">
        Copy Number Variations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../processing_of_rnaseq/" class="md-nav__link">
        RNAseq
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="real-life-example-of-how-to-use-command-line-features">Real life example of how to use command line features<a class="headerlink" href="#real-life-example-of-how-to-use-command-line-features" title="Permanent link">&para;</a></h1>
<p>This is an example of how to use various UNIX/bash/command line features for finding files, assigning variables, parsing and modifying text strings etc. The purpose in the example is to run programs that creates bam files from fastq files and then calculates some quality control metrics. This is done as a loop over multiple samples, where the same commands are applied to every sample. At the end, a table of the resulting metrics of interest is created.</p>
<p>This is not to be run as part of the lab, just a demonstration of a real life example when multiple various command line features are utilized.</p>
<p><div class="highlight"><pre><span></span><code><span class="nb">cd</span> /path/to/project_dir  <span class="c1"># move to project directory</span>
<span class="nv">ref</span><span class="o">=</span>/path/to/human_g1k_v37_decoy.fasta  <span class="c1"># assign path to file as variable</span>
<span class="nv">bwaRef</span><span class="o">=</span>/path/to/bwa/human_g1k_v37_decoy.fasta  <span class="c1"># assign path to file as variable</span>
<span class="nv">tmpDir</span><span class="o">=</span>/scratch/tmp/rebber  <span class="c1"># assign path to directory as variable</span>
<span class="nv">inbox</span><span class="o">=</span>/path/to/fastq_dir  <span class="c1"># assign path to directory as variable</span>
<span class="c1"># find fastq files of interest, </span>
<span class="c1"># extract the sample names from found paths with basename, </span>
<span class="c1"># sort and assign results to array (one sample per array entry):</span>
<span class="nv">samples</span><span class="o">=(</span><span class="k">$(</span>find <span class="nv">$inbox</span> -maxdepth <span class="m">1</span> -mindepth <span class="m">1</span> -newermt <span class="m">2021</span>-01-11 <span class="se">\</span>
    ! -newermt <span class="m">2021</span>-01-12 -name <span class="s2">&quot;PB-P-HD*&quot;</span> <span class="p">|</span> xargs -I <span class="o">{}</span> basename <span class="o">{}</span> <span class="p">|</span> sort<span class="k">)</span><span class="o">)</span>
<span class="nb">echo</span> <span class="si">${</span><span class="nv">samples</span><span class="p">[@]</span><span class="si">}</span>  <span class="c1"># display all entries of array</span>
<span class="nb">echo</span> <span class="si">${#</span><span class="nv">samples</span><span class="p">[@]</span><span class="si">}</span>  <span class="c1"># display number of entries in array</span>
mkdir -p bams  <span class="c1"># create output directory</span>

<span class="c1"># for loop over the samples:</span>
<span class="k">for</span> samp <span class="k">in</span> <span class="si">${</span><span class="nv">samples</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span>
    <span class="c1"># get correct design files:</span>
    <span class="c1"># extract info from sample name (7th field, everything before &quot;2020&quot;):</span>
    <span class="nv">design</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$samp</span> <span class="p">|</span> cut -f <span class="m">7</span> -d <span class="s2">&quot;-&quot;</span> <span class="p">|</span> sed <span class="s1">&#39;s/2020.*//g&#39;</span><span class="k">)</span>
    <span class="c1"># --&gt; e.g. PB-P-HD181117-N-7minfrag-KH20201002-PS20201005 --&gt; PS</span>
    <span class="c1"># assign variables depending on the value of the $design variable:</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="nv">$design</span> <span class="o">==</span> <span class="s2">&quot;PB&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">baits</span><span class="o">=</span>/path/to/PB.baits.interval_list
        <span class="nv">targets</span><span class="o">=</span>/path/to/PB.targets.interval_list
    <span class="k">elif</span> <span class="o">[[</span> <span class="nv">$design</span> <span class="o">==</span> <span class="s2">&quot;PS&quot;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">baits</span><span class="o">=</span>/path/to/PS.baits.interval_list
        <span class="nv">targets</span><span class="o">=</span>/path/to/PS.targets.interval_list
    <span class="k">else</span>
        <span class="nb">echo</span> <span class="s2">&quot;Unknown design </span><span class="nv">$design</span><span class="s2">, skipping sample </span><span class="nv">$samp</span><span class="s2">&quot;</span>  <span class="c1"># print message</span>
        <span class="k">continue</span>  <span class="c1"># skip the rest of the loop for this value of $samp</span>
    <span class="k">fi</span>

    <span class="c1"># skewer (trimming of fastq files)</span>
    <span class="nv">threads</span><span class="o">=</span><span class="m">6</span>  <span class="c1"># set variable to use for this tool</span>
    <span class="nv">dep_jids</span><span class="o">=</span><span class="s2">&quot;&quot;</span>  <span class="c1"># reset list of jobs to depend on (from previous iterations)</span>
    mkdir -p skewer/<span class="nv">$samp</span>  <span class="c1">#create output dir</span>
    <span class="c1"># find the &quot;first in pair&quot; fastq files for this sample:</span>
    <span class="nv">fq1s</span><span class="o">=(</span><span class="k">$(</span>find <span class="nv">$inbox</span>/<span class="nv">$samp</span> -name <span class="s2">&quot;*_1.fastq.gz&quot;</span> <span class="p">|</span> sort<span class="k">)</span><span class="o">)</span>

    <span class="k">for</span> fq1 <span class="k">in</span> <span class="si">${</span><span class="nv">fq1s</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span> <span class="k">do</span>  <span class="c1"># loop over the found fastq files</span>
        <span class="c1"># get the basename of the current fastq file,</span>
        <span class="c1"># sed replaces the pattern (to nothing), </span>
        <span class="c1"># basename removes the path to the file:</span>
        <span class="nv">fqbase</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$fq1</span> <span class="p">|</span> sed <span class="s1">&#39;s/_1.fastq.gz//g&#39;</span><span class="p">|</span> xargs -I <span class="o">{}</span> basename <span class="o">{}</span><span class="k">)</span>
        <span class="c1"># find the corresponding second in pair fastq file, </span>
        <span class="c1"># for the current first in pair fastq file:</span>
        <span class="nv">fq2</span><span class="o">=</span><span class="k">$(</span>find <span class="nv">$inbox</span>/<span class="nv">$samp</span> -name <span class="si">${</span><span class="nv">fqbase</span><span class="si">}</span>_2.fastq.gz<span class="k">)</span>
        <span class="c1"># assign output path and base name:</span>
        <span class="nv">outPrefix</span><span class="o">=</span>skewer/<span class="nv">$samp</span>/skewer.<span class="nv">$fqbase</span>
        <span class="c1"># use sbatch for submitting a job to the slurm queue, set options for it, </span>
        <span class="c1"># then use &quot;here document&quot; to create script on the fly, </span>
        <span class="c1"># that is submitted to slurm</span>
        sbatch -o <span class="nv">$outPrefix</span>.slurm.log -n <span class="nv">$threads</span> -J skewer_<span class="nv">$fqbase</span> &lt;<span class="o">(</span>cat <span class="s">&lt;&lt; EOF</span>
<span class="s">#!/bin/bash  # initiate bash script with shebang</span>
<span class="s"># activate a bash profile which activates access to e.g. a tool set:</span>
<span class="s">. /path/to/.bash_profile</span>
<span class="s">skewer -z -t $threads --quiet -o $outPrefix $fq1 $fq2  # run the desired program </span>
<span class="s">EOF</span>
<span class="o">)</span>

        <span class="c1"># list jobs with squeue command, </span>
        <span class="c1"># get job ID of previously submitted job:</span>
        <span class="nv">jid</span><span class="o">=</span><span class="k">$(</span>squeue -o <span class="s2">&quot;%j %i&quot;</span> <span class="p">|</span> grep skewer_<span class="nv">$fqbase</span> <span class="p">|</span> cut -f <span class="m">2</span> -d <span class="s2">&quot; &quot;</span><span class="k">)</span>
        <span class="nv">dep_jids</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">dep_jids</span><span class="si">}</span><span class="s2">:</span><span class="nv">$jid</span><span class="s2">&quot;</span>  <span class="c1"># append to list of job IDs from this sample</span>
    <span class="k">done</span>  <span class="c1"># end of loop over fastq files</span>

    <span class="c1"># assign variable with job IDs that the next job is going to be dependent on:</span>
    <span class="nv">dep</span><span class="o">=</span><span class="s2">&quot;--dependency=afterok</span><span class="nv">$dep_jids</span><span class="s2">&quot;</span>

    <span class="c1"># mapping</span>
    <span class="nv">threads</span><span class="o">=</span><span class="m">12</span>
    <span class="nv">fastqDir</span><span class="o">=</span>skewer/<span class="nv">$samp</span>
    <span class="nv">outBam</span><span class="o">=</span>bams/raw/<span class="nv">$samp</span>.mapped.bam
    <span class="c1"># submit to slurm queue, with dependency on the previous jobs,</span>
    <span class="c1"># now a pre-written script which takes positional arguments</span>
    sbatch -o <span class="nv">$outBam</span>.slurm.log -n <span class="nv">$threads</span> -J <span class="si">${</span><span class="nv">samp</span><span class="si">}</span>_fastq2mappedBam <span class="nv">$dep</span> <span class="se">\</span>
        /path/to/scripts/fastq2mappedBam.sh <span class="nv">$fastqDir</span> <span class="nv">$outBam</span> <span class="nv">$ref</span> <span class="nv">$bwaRef</span> <span class="se">\</span>
        <span class="nv">$threads</span> <span class="nv">$tmpDir</span>

    <span class="c1"># get jobid of submitted job</span>
    <span class="nv">jid</span><span class="o">=</span><span class="k">$(</span>squeue -o <span class="s2">&quot;%j %i&quot;</span> <span class="p">|</span> grep <span class="si">${</span><span class="nv">samp</span><span class="si">}</span>_fastq2mappedBam <span class="p">|</span> cut -f <span class="m">2</span> -d <span class="s2">&quot; &quot;</span><span class="k">)</span>
    <span class="nv">dep</span><span class="o">=</span><span class="s2">&quot;--dependency=afterok:</span><span class="nv">$jid</span><span class="s2">&quot;</span>  <span class="c1"># dependency</span>

    <span class="c1"># HsMetrics</span>
    <span class="nv">threads</span><span class="o">=</span><span class="m">1</span>
    <span class="nv">inbam</span><span class="o">=</span>bams/raw/<span class="si">${</span><span class="nv">samp</span><span class="si">}</span>.mapped.bam
    <span class="nv">outdir1</span><span class="o">=</span>metrics/HsMetrics/<span class="nv">$design</span>
    mkdir -p <span class="nv">$outdir1</span>
    sbatch -o <span class="nv">$outdir1</span>/<span class="nv">$samp</span>.<span class="nv">$design</span>.hsmetrics.slurm.log -J <span class="si">${</span><span class="nv">samp</span><span class="si">}</span>_HsMetrics <span class="se">\</span>
        -n <span class="nv">$threads</span> <span class="nv">$dep</span> /path/to/scripts/runHsmetrics.sh <span class="nv">$inbam</span> <span class="nv">$outdir1</span> <span class="se">\</span>
        <span class="nv">$targets</span> <span class="nv">$baits</span> <span class="nv">$design</span>

<span class="k">done</span>  <span class="c1"># end of loop over samples</span>

squeue <span class="p">|</span> less -SN  <span class="c1"># check the slurm queue</span>
ls -lhtr skewer/*  <span class="c1"># list content of skewer output dir</span>
<span class="c1"># find the log files and view them with less:</span>
find skewer/ -newermt <span class="m">2021</span>-01-11 -name <span class="s2">&quot;*slurm.log&quot;</span> <span class="p">|</span> xargs less -SN
<span class="c1"># grep for any error message in the log files, </span>
<span class="c1"># remove irrelevant hits, and view the remaining results:</span>
grep -iP <span class="s2">&quot;(error|fail|exception|traceback|cancel|slurm|retry|No such file or directory)&quot;</span> <span class="se">\</span>
    <span class="k">$(</span>find skewer/* -newermt <span class="m">2021</span>-01-11 -name <span class="s2">&quot;*.slurm.log&quot;</span> <span class="p">|</span> sort<span class="k">)</span> <span class="p">|</span> <span class="se">\</span>
    grep -v <span class="s2">&quot;error ratio allowed&quot;</span> <span class="p">|</span> less -SN
<span class="c1"># more checks of output files can be done...</span>

<span class="c1"># make a table of columns 34 (MEAN_TARGET_COVERAGE) and 13 (FOLD_ENRICHMENT)</span>
<span class="c1"># for all the samples</span>
<span class="c1"># the relevant data is on line 8, with the header on line 7</span>
<span class="c1"># use awk to extract the relevant lines and columns</span>
<span class="c1"># NR: row number in total; FNR: row number in file</span>
<span class="c1"># column -t aligns the columns nicely</span>
awk -F <span class="s2">&quot;\t&quot;</span> -v <span class="nv">OFS</span><span class="o">=</span><span class="s2">&quot;\t&quot;</span> <span class="s1">&#39;NR==7 || FNR==8 {print FILENAME, $34, $13}&#39;</span> <span class="se">\</span>
    metrics/HsMetrics/*/*txt <span class="p">|</span> column -t
</code></pre></div>
Resulting QC metrics table:
<div class="highlight"><pre><span></span><code>metrics/HsMetrics/PB/PB-P-HD181110-CFDNA-benchmarking-KH20201002-PB20201005.PB.hsmetrics.txt  MEAN_TARGET_COVERAGE  FOLD_ENRICHMENT
metrics/HsMetrics/PB/PB-P-HD181110-CFDNA-benchmarking-KH20201002-PB20201005.PB.hsmetrics.txt  36390.640776          6267.968261
metrics/HsMetrics/PB/PB-P-HD181115-CFDNA-benchmarking-KH20201002-PB20201005.PB.hsmetrics.txt  34498.125895          6251.155829
metrics/HsMetrics/PS/PB-P-HD181110-N-4minfrag-KH20201002-PS20201005.PS.hsmetrics.txt          64569.379242          16489.157949
metrics/HsMetrics/PS/PB-P-HD181115-N-4minfrag-KH20201002-PS20201005.PS.hsmetrics.txt          67690.957504          17337.593473
</code></pre></div></p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../R_for_bioinformatics/" class="md-footer__link md-footer__link--prev" aria-label="Previous: R for Bioinformatics" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              R for Bioinformatics
            </div>
          </div>
        </a>
      
      
        
        <a href="../human_genome/" class="md-footer__link md-footer__link--next" aria-label="Next: Human Genome" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Human Genome
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021, Johan Lindberg et. al., MEB, Karolinska Institutet, All rights reserved.
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "navigation.sections", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.361d90f1.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.289a2a4b.min.js"></script>
      
    
  </body>
</html>